# This is a GitHub Actions workflow file.
# It will automatically run your Python script on a schedule.

name: Scrape Gabba Events

on:
  # Run this workflow every day at 8:00 AM UTC (which is 6:00 PM AEST)
  schedule:
    - cron: '0 8 * * *'
  
  # Allows you to run this workflow manually from the Actions tab on GitHub
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    # --------------------------

    steps:
      - name: 1. Check out repository
        uses: actions/checkout@v4

      - name: 2. Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # You can change this to a newer version if needed

      - name: 3. Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: 4. Run the scraper
        run: |
          # This executes your Python script
          python gabba_event_scraper.py

      - name: 5. Commit and push the updated .ics file
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          # Add the generated file
          git add gabba-events.ics
          # Commit the changes if any exist
          git diff-index --quiet HEAD || git commit -m "Update Gabba events calendar"
          # Push the changes back to the repository
          git push
